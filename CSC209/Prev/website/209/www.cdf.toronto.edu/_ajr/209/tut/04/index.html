<!doctype html>
<html>


<!-- Mirrored from www.cdf.toronto.edu/~ajr/209/tut/04/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 00:59:02 GMT -->
<head>

<title>CSC 209 tutorial exercises, week of 1 February 2016</title>

<meta name=viewport content="width=device-width, initial-scale=1">

<style type="text/css">
    body {
        color: black;
        background-color: #ffdddd;
    }
    hr {
        border-style: solid;
    }
    div.toc {
        float: right;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 20px;
        padding-bottom: 20px;
        background-color: #cc7777;
        color: white;
        link: white;
        visited: white;
        line-height: 150%;
    }
    div.toc a:link {
        color: white;
    }
    div.toc a:visited {
        color: white;
    }

    .hidden { display: none; }
    .unhidden { display: block; }
</style>

<script type="text/javascript">
    function show(s) {
        document.getElementById(s).className = 'unhidden';
    }
    function reveal(s) {
        document.getElementById(s+'_a').className = 'hidden';
        document.getElementById(s+'_b').className = 'revealed';
    }
</script>

</head>

<body>

<div class=toc>
<a href="../01.html">Tutorial 01</a>
<br>
<a href="../02.html">Tutorial 02</a>
<br>
<a href="../03.html">Tutorial 03</a>
<br>
<a href="../04.html">Tutorial 04</a>
<br>
<a href="../05.html">Tutorial 05</a>
<br>
<a href="../06.html">Tutorial 06</a>
<br>
<a href="../07.html">Tutorial 07</a>
<br>
<a href="../08.html">Tutorial 08</a>
<br>
<a href="../09.html">Tutorial 09</a>
<br>
<a href="../10.html">Tutorial 10</a>
<br>
<a href="../11.html">Tutorial 11</a>
<br>
<a href="../12.html">Tutorial 12</a>
<br>
<p>
[<a href="../../index.html">Course home page</a>]
</div>

<h1>CSC 209 tutorial 04 exercises, week of 1 February 2016</h1>

Please begin by running "/student/csc209/present".
This records your attendance and is required for you to get the marks for the
lab.

<p>
<hr>

<h3> 1. Makefile exercise </h3>

This first part of the tutorial introduces the <cite>make</cite> command, a
tool which builds software from source code, or performs any process which
involves executing shell commands to bring files up to date with respect to
other files.

<p>
<cite>make</cite> reads the file "Makefile" in the current directory, which
tells it what to do to make the various files in that directory.
For each target file, you list commands to create that file; and you also list
the "dependencies", which are the files from which this file is built.
Then if you edit a file and type "make", it checks which dependencies are
newer than their targets (using the last-modified time of the file, or
"mtime"), and executes the commands to (re-)build that file.
All this will hopefully become clear with an example.

<p>
For this tutorial we will use the gcd.c separate-compilation example from
lecture, in which we split up gcd.c into
testgcd.c and gcd.c, with gcd.h to connect them.

<p>
See /student/csc209/tut/04/make.  Please create and cd to a new working
directory of your own and do:

<pre>
	cp /student/csc209/tut/04/make/* .
	mv Makefile.partial Makefile
</pre>

<p>
Makefile.partial (which you've now renamed to "Makefile") says:

<pre>
	testgcd: testgcd.o gcd.o
		gcc -o testgcd testgcd.o gcd.o
</pre>

<p>
The first line means that this recipe
gives commands to create or re-create "testgcd".
But it also says that before you can execute these commands, you need both
testgcd.o and gcd.o.
It further means that to bring testgcd up to date
these commands will need to be re-run any time either testgcd.o or gcd.o
change; and again, that you need to make sure that
"testgcd.o" and "gcd.o" are up to date first before you run these commands to
create or recreate testgcd.
Later the files "testgcd.o" and "gcd.o" can each have their own recipes, and
dependencies, all of which would need to be satisfied/executed first;
there's
a non-trivial "topological sort" algorithm in the 'make' program.

<p>
All that is just the first line.
Next we have the commands (any number of them).
How does <cite>make</cite> tell which line is the recipe
header (with the dependencies) and which lines are the commands?  The rule is:
lines which are commands have to start with a tab.  <i><b>Not</b></i> with an equivalent
number of spaces; it has to be a tab.  This is a bad file format design, but
it's not quite horrible enough that we want to break compatibility by changing it
at this date.  So, tab it is.

<p>
Let's now tell it how to make testgcd.o, by appending further lines to that
file.
Normally we separate the recipes with a blank line.
Then write:
<pre>
        testgcd.o: testgcd.c gcd.h
</pre>

<p>
This is because if either testgcd.c or gcd.h changes, testgcd.o should be
re-made.

<p>
And then, indented by a tab (unlike the above line, which is not indented):
<pre>
                gcc -Wall -c testgcd.c
</pre>

<p>
The '-c' option means just compile to a .o file, not all the way to an a.out
file.  So the fact that testgcd.c calls gcd(), which is not defined in any of
the files included in the
above command-line, is fine for now.  But the final "gcc -o testgcd testgcd.o
gcd.o", which doesn't have a -c option, will put them all together; all
needed functions must be included at that point.

<p>
Try typing "make" now.  If there are syntax errors etc, fix them, then we'll
say a bit more...

<p>
Actually 'make' knows by default that .o files depend on .c files by the same
name, and how to rebuild them, so it managed to build gcd.o too, and get it
all linked together.  But we can do better in two ways:  First of all, note
that the gcc command it used doesn't have "-Wall" in it!  Secondly, if we
modify gcd.h, it won't know that this alone means that gcd.c needs to be
recompiled; it will only recompile gcd.c if gcd.c itself is modified.

<p>
So let's improve this by writing a recipe for gcd.o the same as the testgcd.o
one.

<p>
[do it and test it; sample solution in /student/csc209/tut/04/makesoln/Makefile]

<p>
If you type "make", it builds the first thing mentioned in the file.
Alternatively, you can type something like "make gcd.o" and it will do what
it needs to do for just that.

<p>
Now, look at /student/csc209/tut/04/makesoln/Makefile.  Note the additional recipe
at the end labelled "clean".  There is no file named "clean".  So, if you
type "make clean", even though it doesn't list any dependencies, 'make' will
see that it doesn't exist and will try to build it (by executing the commands
listed).  So this removes the
automatically-generated files.

<p>
Copy that Makefile to your directory and try it (either renaming or
overwriting your own).
The '-f' option to rm
means that rm won't complain if the files don't exist; try it by typing "make
clean" a second time.  Furthermore, 'make' checks the exit status of each
command and stops if it hits an error, so if we don't want it to abort and
print scary messages, we need the -f -- it's not only about avoiding an error
message from rm, it's also about avoiding an error exit status from rm and
hence a fatal error from make as well.
Experiment with this by removing the "-f" and trying more "make"s and "make
clean"s in various sequences.


<p>
<hr>


<h3> 2. To submit: C programming </h3>

The "Fibonacci" numbers can be defined as follows:
<ul>
<li> fib(0) = 0
<li> fib(1) = 1
<li> for all n &ge; 2, fib(n) = fib(n-1) + fib(n-2)
</ul>

The recursive implementation of this is obvious, but is exponential in n.
Instead, write a Fibonacci-calculating program as follows:
<ol>
<li> Declare an array fib[47].  If the user asks for the 47th or greater
Fibonacci number, this will simply be an error (it's too large for an "int"
anyway).
<li> Initialize fib[0] and fib[1], then loop from 2 to n (inclusive) filling
in the array as per the formula.  Note that this is linear in n rather than
exponential.
</ol>

<p>
We haven't talked about accessing command-line arguments in lecture yet
because we haven't talked about strings yet.  So here's a bit of a preview --
just enough to be able to do this tutorial exercise.

<p>
The alternate definition of main() begins like this:
<pre>
	int main(int argc, char **argv)
	{
</pre>

<p>
argv is an array of strings which include the command itself (argv[0]), then the
command-line arguments (argv[1] and following).  But how many string values
are there?  That's what the "argc" parameter is for.  So in this case, you
should insist that argc==2 (the command plus one argument), else print a
usage message and exit (by returning 1 from main()).

<p>
<small>
(A string in C is an array of char, so argv is an array of pointers to the
zeroth elements of such arrays.  But when this is passed to a function the
value decays into a pointer to its zeroth element, so the parameter we get is
a pointer to pointer to char.  You needn't worry about this right now;
we'll talk about this in lecture in detail soon.)
</small>

<p>
So argv[1] will be the "n" argument on the command-line.
But this is a string.
The function "atoi()" converts a string to integer.
So you can call atoi(argv[1]), although only after you've verified that
argc==2.
<br>
To use atoi(), you need to #include &lt;stdlib.h&gt;
<br>
(in addition to #include &lt;stdio.h&gt;)

<p>
If atoi()'s argument is not an integer, it converts as much as it can -- e.g.
atoi("38x") would return 38; and atoi("xyzzy") would return 0.
But you don't have to worry about this for this tutorial exercise.
If the user runs "./a.out xyzzy", you will output 0, that being fib(0), and
this is fine for today.

<p>
The output of your program is simply the nth Fibonacci number (and a newline).

<p>
Call your program fib.c, and submit it in the usual way, by the end of the day:
<pre>
        /student/csc209/submit tut4 fib.c
</pre>
and no matter when you submit it, don't forget to run /student/csc209/present
during the tutorial time, on the console of a tutorial lab workstation.

<p>
(Other 'submit' commands are described at the end of the notes for
<a href="../01/index.html">tutorial one</a>.)

<p>
Your program must compile on the UTM linux
machines with "gcc -Wall" with no errors or warning messages.

<p>
<strong>Testing note:</strong>
In a previous year when I used this exercise I had lots of submissions with off-by-one errors.
Check that you are using the above definition of the Fibonacci numbers.
For example, "./a.out 10" should output 55 (which is fib(10)).

<p>
<hr width="25%" align=left>
<p>
Q: Do we need to check argc and output a usage message?

<p>
A: Yes!  Always!  And the usage message must be in the standard format (see
the SYNOPSIS line from the man page exercise in <a href="../03/index.html">tutorial
three</a>), <!-- and to stderr, --> and you must exit with exit status 1 in case of
error or 0 in the normal case (by returning these values from main()).

<p>
<hr>

</body>

<!-- Mirrored from www.cdf.toronto.edu/~ajr/209/tut/04/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 00:59:02 GMT -->
</html>
