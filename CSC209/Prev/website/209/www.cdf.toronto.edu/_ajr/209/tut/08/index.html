<!doctype html>
<html>


<!-- Mirrored from www.cdf.toronto.edu/~ajr/209/tut/08/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 00:59:04 GMT -->
<head>

<title>CSC 209 tutorial exercises, week of 7 March 2016</title>

<meta name=viewport content="width=device-width, initial-scale=1">

<style type="text/css">
    body {
        color: black;
        background-color: #ffdddd;
    }
    hr {
        border-style: solid;
    }
    div.toc {
        float: right;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 20px;
        padding-bottom: 20px;
        background-color: #cc7777;
        color: white;
        link: white;
        visited: white;
        line-height: 150%;
    }
    div.toc a:link {
        color: white;
    }
    div.toc a:visited {
        color: white;
    }

    .hidden { display: none; }
    .unhidden { display: block; }
</style>

<script type="text/javascript">
    function show(s) {
        document.getElementById(s).className = 'unhidden';
    }
    function reveal(s) {
        document.getElementById(s+'_a').className = 'hidden';
        document.getElementById(s+'_b').className = 'revealed';
    }
</script>

</head>

<body>

<div class=toc>
<a href="../01.html">Tutorial 01</a>
<br>
<a href="../02.html">Tutorial 02</a>
<br>
<a href="../03.html">Tutorial 03</a>
<br>
<a href="../04.html">Tutorial 04</a>
<br>
<a href="../05.html">Tutorial 05</a>
<br>
<a href="../06.html">Tutorial 06</a>
<br>
<a href="../07.html">Tutorial 07</a>
<br>
<a href="../08.html">Tutorial 08</a>
<br>
<a href="../09.html">Tutorial 09</a>
<br>
<a href="../10.html">Tutorial 10</a>
<br>
<a href="../11.html">Tutorial 11</a>
<br>
<a href="../12.html">Tutorial 12</a>
<br>
<p>
[<a href="../../index.html">Course home page</a>]
</div>

<h1>CSC 209 tutorial 08 exercises, week of 7 March 2016</h1>

Please begin by running "/student/csc209/present".
This records your attendance and is required for you to get the marks for the
lab.

<h3> 1. fork exercise </h3>

Write a program which creates five child processes, numbered 0 through 4.
Each child process computes the sum of the integers 5i through 5i+4, where i
is its index number.  It then returns this value as the process exit status.
The parent then waits for them all and outputs the total of the exit statuses,
which will be the sum of the integers from 0 to 24 inclusive.

<p>
This is an abuse of process exit status, but I think it's fun and a good
exercise.

<p>
<a href="forksolution.c">sample solution</a> -- please don't look at the
sample solution until you've spent some time on this problem!


<h3> 2. pwd exercise </h3>

Write a program which does most of the work of "pwd", as follows:

<p>
First, call lstat() on "." to find out the inode number of the current
directory (the "st_ino" member of the struct stat).
(Remember that we looked at stat() and lstat() in
<a href="../05/index.html">tutorial five</a>.)

<p>
Then we change our current directory to the parent directory, with
chdir("..").

<p>
Then we want to read the
parent directory with opendir()/readdir() (using "opendir(".")" because we've
now cd'd there),
but unlike in the assignment two directory traversal problem,
we are mostly interested in the
d_ino value in the struct returned by readdir().  We are looking for the
original directory in the parent directory.  When we find it, we print its
name.

<p>
Then call chdir("..") again, and repeat until the inode number is 2, at which
point you can print "and then we're at the root directory" (or some such
similar message).

<p>
So if the real pwd would output "/home/ajr/209/example", your pwd will output
<blockquote>
example
<br>
209
<br>
ajr
<br>
home
<br>
and then we're at the root directory.
</blockquote>

<p>
Except... there are two wrinkles here which affect specifically the linux
machines at UTM (and many other computers):

<p>
<!--
First of all, you will find that you do not have read access to /cmshome.
-->
Most of all, there is something strange about the network filesystem mount
/student.  It is listed under a different inode number in the root directory,
as opposed to what lstat() will give you about "." when you are cd'd to
/student.  There seems to be some unfortunate non-unix semantics with this
network file server.

<p>
So if you are running this while cd'd to something under your home directory,
<!--
you will get an error from one of the opendir() calls.  (Make sure you are
calling perror() appropriately!)
-->
when you get to /student you will not be able to find its inode number in the
parent, and your program will (should) output an appropriate error message
to this effect.

So at least some of your testing needs to be
while cd'd to directories outside your home directory.  For example, there
are interesting world-readable directory hierarchies under /usr/local/share
for you to use (especially /usr/local/share/man) (and there are many others).

<p>
Secondly, even in the absence of <!-- read errors, --> the funniness around
/student,

the above algorithm will often stop short of the real
root directory, because there are multiple filesystems which are "mounted"
in the directory tree, as we discussed when discussing the unix filesystem;
and the root directory of any filesystem has inode number 2.  We won't fix
this for this exercise today; your program will just show you part of the pwd
data.
All this is to say that you might have to cd into some subdirectories
to make the output interesting.

<p>
Remember to include all relevant error checking, with appropriate use of
perror().

<p>
The "real" pwd in linux these days actually uses a totally different
algorithm, which is a linux-specific interface for querying the current
working directory.
But the above is the traditional algorithm.
But this means, especially given the
<!--
permissions on /cmshome,
-->
nature of /student,
that you might
want to compare your program's behaviour to mine.  So I've put a compiled
solution in /student/csc209/tut/08/pwd

<p>
(To be clear: You may not use getcwd().  You are to use the above algorithm.
An algorithm similar to the above traditionally appears in getcwd().  Your
task is to write this algorithm.)

<p>
(Note that you don't need to declare the argc and argv parameters to main
(and don't need to check usage).)

<h3> To submit </h3>

<p>
First of all, you must run "/student/csc209/present",
during the tutorial time, on the console of a tutorial lab workstation.

<p>
Then, submit your best version of pwd.c for credit for this tutorial by the
end of the day your tutorial is on.
To get the mark, it has to perform the basic pwd function using the above
algorithm, and it has to
compile with "gcc -Wall pwd.c" on the UTM linux machines with no errors or
warning messages.

<p>
Submit with the command
<pre>
        /student/csc209/submit tut8 pwd.c
</pre>
and the other submit commands are as before.

<p>
<hr>

</body>

<!-- Mirrored from www.cdf.toronto.edu/~ajr/209/tut/08/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 00:59:04 GMT -->
</html>
