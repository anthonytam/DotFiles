<!doctype html>
<html>


<!-- Mirrored from www.cdf.toronto.edu/~ajr/209/tut/07/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 00:59:02 GMT -->
<head>

<title>CSC 209 tutorial exercises, week of 29 February 2016</title>

<meta name=viewport content="width=device-width, initial-scale=1">

<style type="text/css">
    body {
        color: black;
        background-color: #ffdddd;
    }
    hr {
        border-style: solid;
    }
    div.toc {
        float: right;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 20px;
        padding-bottom: 20px;
        background-color: #cc7777;
        color: white;
        link: white;
        visited: white;
        line-height: 150%;
    }
    div.toc a:link {
        color: white;
    }
    div.toc a:visited {
        color: white;
    }

    .hidden { display: none; }
    .unhidden { display: block; }
</style>

<script type="text/javascript">
    function show(s) {
        document.getElementById(s).className = 'unhidden';
    }
    function reveal(s) {
        document.getElementById(s+'_a').className = 'hidden';
        document.getElementById(s+'_b').className = 'revealed';
    }
</script>

</head>

<body>

<div class=toc>
<a href="../01.html">Tutorial 01</a>
<br>
<a href="../02.html">Tutorial 02</a>
<br>
<a href="../03.html">Tutorial 03</a>
<br>
<a href="../04.html">Tutorial 04</a>
<br>
<a href="../05.html">Tutorial 05</a>
<br>
<a href="../06.html">Tutorial 06</a>
<br>
<a href="../07.html">Tutorial 07</a>
<br>
<a href="../08.html">Tutorial 08</a>
<br>
<a href="../09.html">Tutorial 09</a>
<br>
<a href="../10.html">Tutorial 10</a>
<br>
<a href="../11.html">Tutorial 11</a>
<br>
<a href="../12.html">Tutorial 12</a>
<br>
<p>
[<a href="../../index.html">Course home page</a>]
</div>

<h1>CSC 209 tutorial 07 exercises, week of 29 February 2016</h1>

<p>
<hr>
<p>
Please begin by running "/student/csc209/present".
This records your attendance and is required for you to get the marks for the
lab.

<!--

<p>
<hr>

<h2> Important preliminary note </h2>

There are way too many suspiciously-similar recent tutorial submissions.
Your work submitted for course credit must be your own.  Sharing your
work before the due date is strictly prohibited, and I will prosecute
as necessary to maintain the academic integrity of this course.

-->

<p>
<hr>

<h2> Critiquing and improving C code </h2>

The author of the following C code thinks that it "works",
but actually there are some problems with it.

<p>
Some of it does work, but is unnecessarily complicated or otherwise
unnecessarily difficult to read.  Your task for this tutorial is to simplify
such code, maintaining its function.

<p>
Some of it works only in straightforward conditions but performs incorrectly
in boundary cases or error conditions.

<h3> Example question 1: </h3>

<p>
Code excerpt:
<br>
<pre>
void g()
{
    int d = x + 5;
    if (d &lt; e) {
        [ten lines of code not involving 'd']
    }
    [twenty lines of code not involving 'd']
}
</pre>

<p>
Solution:
<br>
Change "if (d &lt; e)" to "if (x + 5 &lt; e)" and get rid of the 'd' variable.
This is simpler, but more importantly, with the original code the reader will be looking for where
'd' is used later on.
And suppose, for example, that in future we need instead to
compare "if (x + 6 &lt; e)".  Should we change d to "x+6" or will this cause
trouble elsewhere?  Unless this d value is <strong>very</strong> meaningful,
the simpler version, without the additional variable, is much clearer for
these sorts of reasons.
<h3> Question 2: </h3>

Problem:
<br>
Add three to the parameter.

<p>
Code:
<pre>
int f(int x)
{
    int d = x + 3;
    return(d);
}
</pre>

<p>
[<a href="q2s.html">solution</a>]
(the problem is repeated on the solution page, for each of today's problems)

<h3> Question 3: </h3>

Problem:
<br>
Open a file and terminate with an error if it doesn't exist:

<p>
Code:
<pre>
    if (stat(file, &statbuf)) {
        printf("%s: No such file or directory\n", file);
        exit(1);
    }
    fp = fopen(file, "r");
</pre>

<p>
[<a href="q3s.html">solution</a>]

<h3> Question 4: </h3>

Problem:
<br>
Open a file and terminate with an error if it doesn't exist (same problem):

<p>
Code:
<pre>
    if ((fp = fopen(file, "r")) == NULL) {
        perror("opening the file");
        exit(1);
    }
</pre>

<p>
[<a href="q4s.html">solution</a>]

<h3> Question 5: </h3>

Problem:
<br>
A function which returns true/false to indicate whether the argument exists
and is a plain file (much like "test -f"):

<p>
Code:
<pre>
int fexists(char *file)
{
    struct stat *p;
    p = malloc(sizeof(struct stat));
    return(stat(file, p) == 0 &amp;&amp; (p->st_mode &amp; S_IFMT) == S_IFREG);
}
</pre>

<p>
[<a href="q5s.html">solution</a>]

<h3> Question 6: </h3>

Problem:
<br>
Read a number from the file "foo", or return -1 if the file doesn't exist or
doesn't begin with a number.

<p>
Code:
<pre>
int foonumber()
{
    int x;
    FILE *fp = fopen("foo", "r");
    if (fp == NULL)
        perror("foo");
    if (fscanf(fp, "%d", &x) == 0)
        return(-1);
    return(x);
}
</pre>

<p>
[<a href="q6s.html">solution</a>]
(there are at least three entirely separate problems with this code)

<h3> Question 7: </h3>

Problem:
<br>
"./a.out num1 num2" outputs the sum of the two numbers.

<p>
Code:
<pre>
int main(int argc, char **argv)
{
    if (argv[2] == NULL) {
        printf("two integers required on the command line");
        return(55);
    }
    printf("%d", atoi(argv[1]) + atoi(argv[2]));
}
</pre>

<p>
[<a href="q7s.html">solution</a>]
-- but don't look at the solution after you've fixed just one problem --
there are at least five!

<p><hr><p>

<h2> To submit: </h2>

Problem:
<br>
A simple cat-like program which opens a file whose name is on the
command-line,
and copies its contents to stdout.

<p>
Code:
<pre>
#include &lt;stdio.h&gt;

int main(int argc, char **argv)
{
    FILE *fp;
    char c;

    if (argc &lt; 2)
	printf("put a file name");

    fp = fopen(argv[1], "r+");
    while ((c = getc(fp)) &gt; 0)
	putchar(c);

    return(1);
}
</pre>

<p>
You can find the above text in /student/csc209/tut/07/tut7.c
<br>
Submit your improved program in a file named "tut7.c".

<p>
Your should not add or change anything which is not specifically to fix a defect
in the above program.  However, your program should behave like a proper unix
program -- for example, one of the defects above is the incorrect exit status.
Its error handling and message(s) are also wrong.

<p>
Programs which do not compile with "gcc -Wall" with no errors or warnings
will not get the mark for this tutorial.  However, this is not the only
cleanup required.  I count ten defects above (although it does depend on how
you count), of which you must fix at least six (without introducing any new
defects nor changing anything irrelevant) to get the mark.

<p>
Submit your file with
<pre>
        /student/csc209/submit tut7 tut7.c
</pre>
, by the end of your tutorial day,
and don't forget to run /student/csc209/present
during the tutorial time, on the console of a tutorial lab workstation.

<p>
Q: What does "r+" do in the fopen()?
<br>
A: It opens for read-write -- after that, it is possible either to read from
or to write to the file.  Thus this fails if the file is read-only.

<p>
<hr>

</body>

<!-- Mirrored from www.cdf.toronto.edu/~ajr/209/tut/07/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 00:59:04 GMT -->
</html>
